(lang dune 3.0)

(generate_opam_files true)
(name llama)

(source (github gridbugs/llama))
(license MIT)
(authors "Stephen Sherratt")
(maintainers "https://github.com/gridbugs/llama/issues")

(package
 (name llama)
 (synopsis "Language for Live Audio Module Arrangement")
 (description "Libraries for declaratively building software-defined modular synthesizers. Contains definitions of common modules for generating and processing audio waveforms such as oscillators, filters, envelope generators, sequencers and clocks. This package also includes a mechanism for playing sounds generated by synthesizer components through your speakers.
NOTE: Some low-level operations are done by a small rust library bundled in this package. Thus a rust installation is required to install this. The default versions of this package depend on conf-rust-2021 and will prompt to install rust system-wide if it's not already installed. To accommodate for the situation where rust is managed with the rustup tool instead, there are alternative *-rustup versions of this package which are identical except that they don't depend on conf-rust-2021 and will fail to install if no rust installation is present.")
 (depends

  ; The ocaml-boxroot-sys-0.2.0 crate doesn't build with ocaml 5.
  ; Some numerical operations only became available in 4.13.
  (ocaml (and (>= "4.13.0") (< "5.0.0")))

  (lwt (>= 5.4))

  ; Many rust users never install rust with their system package manager and
  ; instead use the rustup tool to manage rust installations. Thus we want to
  ; cater for the case where a user doesn't want to install rust globally but
  ; still wants to use this tool, but it would also be useful to support the
  ; case where a user wants 'opam install llama' to just work without having to
  ; think about the fact that it depends on rust. To cater for both cases we'll
  ; release a version of this package which explicitly depends on
  ; "conf-rust-2021" and a second version which doesn't. By default in the opam
  ; file checked into git we won't depend on rust so that users who clone this
  ; repo can manage their own rust installation.
  ; conf-rust-2021

  ; On linux, "alsa" is a dependency of the rust package "cpal" and we can use
  ; opam to install it for us.
  (conf-alsa (= :os linux))))

(package
 (name llama_interactive)
 (synopsis "Visualization and live interaction for Llama synthesizer library")
 (depends
  llama
  (ocamlsdl2 (>= 0.04))))
